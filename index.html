<!doctypehtml><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1,user-scalable=no"name=viewport><title>toda - Astronomical Visualization</title><style>*{margin:0;padding:0;box-sizing:border-box}body,html{width:100%;height:100%;overflow:hidden}body{background:#000;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;color:#fff}#canvas{position:absolute;top:0;left:0;display:block;background:#000}#overlay{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10}#header{position:absolute;top:0;left:0;right:0;background:linear-gradient(to bottom,rgba(0,0,0,.8) 0,rgba(0,0,0,0) 100%);padding:15px 20px;pointer-events:auto;transition:opacity .3s ease}#header h1{font-size:20px;font-weight:300;letter-spacing:2px;text-transform:uppercase;background:linear-gradient(90deg,#00d4ff,#90f7ec);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;display:inline-block}#fullscreen-btn{position:absolute;top:15px;right:20px;background:rgba(0,212,255,.2);border:1px solid rgba(0,212,255,.5);color:#00d4ff;padding:8px 16px;border-radius:5px;cursor:pointer;font-size:14px;transition:all .3s ease;pointer-events:auto}#fullscreen-btn:hover{background:rgba(0,212,255,.4);border-color:#00d4ff}#controls{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,rgba(0,0,0,.8) 0,rgba(0,0,0,0) 100%);padding:20px 20px 15px 20px;font-size:12px;line-height:1.8;pointer-events:auto;transition:opacity .3s ease}#controls strong{color:#00d4ff}#status{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.9);padding:30px 50px;border-radius:10px;border:1px solid rgba(0,212,255,.5);text-align:center;font-size:18px;pointer-events:auto}#status .loading{display:inline-block;width:50px;height:50px;border:4px solid rgba(0,212,255,.3);border-top:4px solid #00d4ff;border-radius:50%;animation:spin 1s linear infinite;margin:20px auto}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.hidden{display:none!important}.fade-out{opacity:0!important}#touch-hint{position:absolute;bottom:80px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.7);padding:10px 20px;border-radius:20px;font-size:14px;opacity:0;transition:opacity .3s ease;pointer-events:none}#touch-hint.visible{opacity:1}#time-control{position:absolute;top:50px;right:20px;background:rgba(0,0,0,.85);border:1px solid rgba(0,212,255,.5);border-radius:8px;padding:12px 15px;font-size:12px;pointer-events:auto;display:none;min-width:280px}#time-control.visible{display:block}#time-control .time-display{text-align:center;color:#fff;font-size:14px;font-family:monospace;margin-bottom:10px;padding:8px;background:rgba(0,212,255,.1);border-radius:4px}#time-control .time-display .date{color:#00d4ff;font-size:12px}#time-control .slider-container{margin-bottom:10px}#time-control .slider-labels{display:flex;justify-content:space-between;color:#888;font-size:10px;margin-bottom:3px}#time-control input[type=range]{width:100%;height:6px;-webkit-appearance:none;appearance:none;background:linear-gradient(to right,rgba(0,212,255,.3),rgba(0,212,255,.5),rgba(0,212,255,.3));border-radius:3px;outline:0;cursor:pointer}#time-control input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:#00d4ff;border-radius:50%;cursor:pointer;box-shadow:0 0 5px rgba(0,212,255,.8)}#time-control input[type=range]::-moz-range-thumb{width:16px;height:16px;background:#00d4ff;border-radius:50%;cursor:pointer;border:none;box-shadow:0 0 5px rgba(0,212,255,.8)}#time-control .time-buttons{display:flex;gap:5px;margin-bottom:8px}#time-control button{flex:1;background:rgba(0,212,255,.2);border:1px solid rgba(0,212,255,.4);color:#00d4ff;padding:5px 8px;border-radius:4px;cursor:pointer;font-size:11px;transition:all .2s ease}#time-control button:hover{background:rgba(0,212,255,.4)}#time-control button.active{background:rgba(0,212,255,.5);border-color:#00d4ff}#time-control .speed-label{text-align:center;color:#90f7ec;font-size:11px;margin-top:5px}#time-toggle-btn{position:absolute;top:15px;right:130px;background:rgba(0,212,255,.2);border:1px solid rgba(0,212,255,.5);color:#00d4ff;padding:8px 12px;border-radius:5px;cursor:pointer;font-size:14px;transition:all .3s ease;pointer-events:auto}#time-toggle-btn:hover{background:rgba(0,212,255,.4);border-color:#00d4ff}#time-toggle-btn.active{background:rgba(0,212,255,.4)}</style></head><body><canvas id=canvas oncontextmenu=event.preventDefault() tabindex=-1></canvas><div id=overlay><div id=header><h1>toda - Universe Explorer</h1><button id=time-toggle-btn>Time</button><button id=fullscreen-btn>Fullscreen</button></div><div id=time-control><div class=time-display><div id=time-date class=date>2025-01-01</div><div id=time-clock>00:00:00 UTC</div></div><div class=slider-container><div class=slider-labels><span>-15 days</span><span>now</span><span>+15 days</span></div><input id=time-slider max=15 min=-15 step=0.001 type=range value=0></div><div class=time-buttons><button id=time-now-btn title="Set to current time">Now</button><button id=time-play-btn title="Play/Pause time">▶</button></div><div class=time-buttons><button id=time-slower-btn title="Slow down">◀◀</button><button id=time-faster-btn title="Speed up">▶▶</button></div><div id=speed-label class=speed-label>Paused</div></div><div id=status><div>Loading toda...</div><div class=loading></div></div><div id=controls><strong>Controls:</strong>WASD/Arrow Keys: Move | Mouse: Look around | Q/E: Roll | +/-: Zoom | M/Tab: Toggle View Mode (Universe/Planet/Moon) | G: Toggle Grid | S: Toggle Stars | T: Toggle Time | F: Toggle FPS | H: Toggle HUD | ESC: Quit</div><div id=touch-hint>Tap to interact</div></div><script>var statusElement=document.getElementById("status"),canvasElement=document.getElementById("canvas"),headerElement=document.getElementById("header"),controlsElement=document.getElementById("controls"),fullscreenBtn=document.getElementById("fullscreen-btn"),touchHint=document.getElementById("touch-hint"),uiHideTimeout=null,uiVisible=!0,canvasInfo={width:window.innerWidth,height:window.innerHeight,isFullscreen:!1,needsUpdate:!0};function resizeCanvas(){var e=window.innerWidth,t=window.innerHeight;canvasInfo.isFullscreen=!(!document.fullscreenElement&&!document.webkitFullscreenElement);var n=e,o=t;canvasElement.width===n&&canvasElement.height===o||(canvasElement.width=n,canvasElement.height=o,canvasElement.style.width=n+"px",canvasElement.style.height=o+"px",canvasInfo.width=n,canvasInfo.height=o,canvasInfo.needsUpdate=!0,console.log("Canvas resized: "+n+"x"+o+" (fullscreen: "+canvasInfo.isFullscreen+")"))}function showUI(){headerElement.classList.remove("fade-out"),controlsElement.classList.remove("fade-out"),uiVisible=!0,resetUIHideTimer()}function hideUI(){statusElement.classList.contains("hidden")&&(headerElement.classList.add("fade-out"),controlsElement.classList.add("fade-out"),uiVisible=!1)}function resetUIHideTimer(){uiHideTimeout&&clearTimeout(uiHideTimeout),uiHideTimeout=setTimeout(hideUI,3e3)}function toggleFullscreen(){if(document.fullscreenElement||document.webkitFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),fullscreenBtn.textContent="Fullscreen";else{var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),fullscreenBtn.textContent="Exit Fullscreen"}}function onFullscreenChange(){document.fullscreenElement||document.webkitFullscreenElement?fullscreenBtn.textContent="Exit Fullscreen":fullscreenBtn.textContent="Fullscreen",resizeCanvas()}!function(){var e=window.innerWidth,t=window.innerHeight;canvasElement.width=e,canvasElement.height=t,canvasElement.style.width=e+"px",canvasElement.style.height=t+"px",canvasInfo.width=e,canvasInfo.height=t,console.log("Initial canvas: "+e+"x"+t)}(),window.getCanvasWidth=function(){return canvasInfo.width},window.getCanvasHeight=function(){return canvasInfo.height},window.isCanvasFullscreen=function(){return canvasInfo.isFullscreen?1:0},window.getCanvasDevicePixelRatio=function(){return canvasInfo.devicePixelRatio},window.hasCanvasSizeChanged=function(){return canvasInfo.needsUpdate?(canvasInfo.needsUpdate=!1,1):0},window.addEventListener("resize",resizeCanvas),document.addEventListener("fullscreenchange",onFullscreenChange),document.addEventListener("webkitfullscreenchange",onFullscreenChange),fullscreenBtn.addEventListener("click",(function(e){e.stopPropagation(),toggleFullscreen()})),document.addEventListener("mousemove",(function(){uiVisible?resetUIHideTimer():showUI()}));var isTouchDevice="ontouchstart"in window;isTouchDevice&&(touchHint.classList.add("visible"),setTimeout((function(){touchHint.classList.remove("visible")}),3e3)),document.addEventListener("touchstart",(function(){uiVisible?resetUIHideTimer():showUI()})),canvasElement.addEventListener("click",(function(){canvasElement.focus()})),resetUIHideTimer();var browserGeolocation={latitude:0,longitude:0,available:!1,error:null,timestamp:0};function requestGeolocation(){if(!navigator.geolocation)return browserGeolocation.error="Geolocation not supported",void console.log("Geolocation: Not supported by this browser");navigator.geolocation.getCurrentPosition((function(e){browserGeolocation.latitude=e.coords.latitude,browserGeolocation.longitude=e.coords.longitude,browserGeolocation.available=!0,browserGeolocation.timestamp=Date.now(),browserGeolocation.error=null,console.log("Geolocation: "+browserGeolocation.latitude.toFixed(4)+", "+browserGeolocation.longitude.toFixed(4))}),(function(e){switch(browserGeolocation.available=!1,e.code){case e.PERMISSION_DENIED:browserGeolocation.error="Permission denied";break;case e.POSITION_UNAVAILABLE:browserGeolocation.error="Position unavailable";break;case e.TIMEOUT:browserGeolocation.error="Request timeout";break;default:browserGeolocation.error="Unknown error"}console.log("Geolocation error: "+browserGeolocation.error)}),{enableHighAccuracy:!1,timeout:1e4,maximumAge:3e5})}requestGeolocation(),window.getBrowserGeolocationAvailable=function(){return browserGeolocation.available?1:0},window.getBrowserGeolocationLatitude=function(){return browserGeolocation.latitude},window.getBrowserGeolocationLongitude=function(){return browserGeolocation.longitude},window.getBrowserGeolocationError=function(){return browserGeolocation.error||""},window.getBrowserCurrentTime=function(){return Date.now()/1e3},window.getBrowserTimezoneOffset=function(){return-(new Date).getTimezoneOffset()/60};var timeControlElement=document.getElementById("time-control"),timeToggleBtn=document.getElementById("time-toggle-btn"),timeSlider=document.getElementById("time-slider"),timeDateDisplay=document.getElementById("time-date"),timeClockDisplay=document.getElementById("time-clock"),timeNowBtn=document.getElementById("time-now-btn"),timePlayBtn=document.getElementById("time-play-btn"),timeSlowerBtn=document.getElementById("time-slower-btn"),timeFasterBtn=document.getElementById("time-faster-btn"),speedLabel=document.getElementById("speed-label"),timeControlState={visible:!1,speed:0,baseJd:0,updateInterval:null,isDragging:!1};function jdToDate(e){return new Date(1e3*(86400*(e-2440587.5)))}function dateToJd(e){return e.getTime()/1e3/86400+2440587.5}function formatDate(e){return e.getUTCFullYear()+"-"+String(e.getUTCMonth()+1).padStart(2,"0")+"-"+String(e.getUTCDate()).padStart(2,"0")}function formatTime(e){return String(e.getUTCHours()).padStart(2,"0")+":"+String(e.getUTCMinutes()).padStart(2,"0")+":"+String(e.getUTCSeconds()).padStart(2,"0")+" UTC"}timeToggleBtn.addEventListener("click",(function(e){e.stopPropagation(),timeControlState.visible=!timeControlState.visible,timeControlState.visible?(timeControlElement.classList.add("visible"),timeToggleBtn.classList.add("active"),initTimeControl(),startTimeControlUpdate()):(timeControlElement.classList.remove("visible"),timeToggleBtn.classList.remove("active"),stopTimeControlUpdate())}));var wasmReady=!1,wasm_getJulianDate=null,wasm_getTimeSpeed=null,wasm_setTimeSpeed=null,wasm_setDateTime=null;function initWasmFunctions(){if(wasmReady)return!0;if("function"!=typeof Module.cwrap)return!1;try{return wasm_getJulianDate=Module.cwrap("wasm_getJulianDate","number",[]),wasm_getTimeSpeed=Module.cwrap("wasm_getTimeSpeed","number",[]),wasm_setTimeSpeed=Module.cwrap("wasm_setTimeSpeed",null,["number"]),wasm_setDateTime=Module.cwrap("wasm_setDateTime",null,["number","number","number","number","number","number"]),wasmReady=!0,!0}catch(e){return console.error("Failed to init WASM functions:",e),!1}}function initTimeControl(){initWasmFunctions()&&(timeControlState.baseJd=wasm_getJulianDate(),timeSlider.value=0,updateTimeDisplay(),updateSpeedFromWasm())}function updateTimeDisplay(){if(wasmReady){var e=wasm_getJulianDate(),t=jdToDate(e);if(timeDateDisplay.textContent=formatDate(t),timeClockDisplay.textContent=formatTime(t),!timeControlState.isDragging&&timeControlState.baseJd>0){var n=e-timeControlState.baseJd;n=Math.max(-15,Math.min(15,n)),timeSlider.value=n}}}function updateSpeedFromWasm(){wasmReady&&(timeControlState.speed=wasm_getTimeSpeed(),updateSpeedLabel())}function updateSpeedLabel(){var e=timeControlState.speed;0===e?(speedLabel.textContent="Paused",timePlayBtn.textContent="▶"):1===e?(speedLabel.textContent="Real-time",timePlayBtn.textContent="⏸"):e>0?(speedLabel.textContent=e.toFixed(0)+"x",timePlayBtn.textContent="⏸"):(speedLabel.textContent=e.toFixed(0)+"x (reverse)",timePlayBtn.textContent="⏸")}function startTimeControlUpdate(){timeControlState.updateInterval||(timeControlState.updateInterval=setInterval((function(){updateTimeDisplay(),updateSpeedFromWasm()}),200))}function stopTimeControlUpdate(){timeControlState.updateInterval&&(clearInterval(timeControlState.updateInterval),timeControlState.updateInterval=null)}function setTimeFromJd(e){if(wasmReady){var t=jdToDate(e);wasm_setDateTime(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds()+t.getUTCMilliseconds()/1e3)}}timeSlider.addEventListener("mousedown",(function(){timeControlState.isDragging=!0})),timeSlider.addEventListener("touchstart",(function(){timeControlState.isDragging=!0})),timeSlider.addEventListener("mouseup",(function(){timeControlState.isDragging=!1})),timeSlider.addEventListener("touchend",(function(){timeControlState.isDragging=!1})),timeSlider.addEventListener("input",(function(){var e=parseFloat(timeSlider.value);setTimeFromJd(timeControlState.baseJd+e),updateTimeDisplay()})),timeNowBtn.addEventListener("click",(function(){if(wasmReady){var e=new Date;wasm_setDateTime(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()),timeControlState.baseJd=dateToJd(e),timeSlider.value=0,updateTimeDisplay()}})),timePlayBtn.addEventListener("click",(function(){wasmReady&&(0===timeControlState.speed?(wasm_setTimeSpeed(1),timeControlState.speed=1):(wasm_setTimeSpeed(0),timeControlState.speed=0),updateSpeedLabel())})),timeSlowerBtn.addEventListener("click",(function(){if(wasmReady){var e=timeControlState.speed;e>0&&e<=1?e=-1:e>0?e/=10:e<0?e*=10:e=-1,e=Math.max(-31536e3,e),wasm_setTimeSpeed(e),timeControlState.speed=e,updateSpeedLabel()}})),timeFasterBtn.addEventListener("click",(function(){if(wasmReady){var e=timeControlState.speed;0===e?e=1:e>0?e*=10:e<0&&e>=-1?e=1:e/=10,e=Math.min(31536e3,e),wasm_setTimeSpeed(e),timeControlState.speed=e,updateSpeedLabel()}}));var Module={preRun:[function(){"undefined"!=typeof addOnPostRun&&addOnPostRun((function(){console.log("Post-run GL emulation check")}))}],postRun:[],canvas:canvasElement,initGLEmulation:function(){console.log("Initializing GL emulation arrays..."),"undefined"!=typeof GLEmulation&&(GLEmulation.rendererComponents||(GLEmulation.rendererComponents=[]),GLEmulation.enabledClientAttribIndices||(GLEmulation.enabledClientAttribIndices=[]),console.log("GLEmulation arrays initialized"))},print:function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments).join(" ")),console.log(e)},printErr:function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments).join(" ")),console.error(e)},setStatus:function(e){if(Module.setStatus.last||(Module.setStatus.last={time:Date.now(),text:""}),e!==Module.setStatus.last.text){var t=e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/),n=Date.now();t&&n-Module.setStatus.last.time<30||(Module.setStatus.last.time=n,Module.setStatus.last.text=e,e?(statusElement.querySelector("div:first-child").innerHTML=e,console.log("Status: "+e)):(statusElement.classList.add("hidden"),canvasElement.style.visibility="visible",resetUIHideTimer()))}},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),Module.setStatus(e?"Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")":"All downloads complete.")},onRuntimeInitialized:function(){console.log("toda initialized successfully!"),Module.setStatus(""),resizeCanvas()}};Module.setStatus("Downloading..."),window.onerror=function(e){Module.setStatus("Exception thrown, see JavaScript console"),statusElement.querySelector("div:first-child").innerHTML="Exception: "+e,Module.setStatus=function(e){e&&Module.printErr("[post-exception status] "+e)}}</script><script async src=toda.js></script></body></html>